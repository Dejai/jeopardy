<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>

    <link rel="stylesheet" type="text/css" href="../../src/game.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">

	<link rel="stylesheet" type="text/css" href="../../src/game.css">

</head>
<body style="width:70%; margin:auto;">

    <div id="edit_section_game_questions" class="edit_section selected_section">
        <div id="listOfCategories"></div>
        <hr/>
        <div id="questionForm" class="hidden">
            <h3>Category: <span id="questionFormCategoryName"></span></h3>
            <div id="questionFormActions1" class="float:right;">
                <button onclick="onUpdateQuestionForm()">UPDATE</button>
                <button onclick="onCancelQuestionForm()">CANCEL</button>
            </div>
            <br style="clear:both;"/>
            <table style="width:100%" style="text-align:center;">
                <tr>
                    <td>
                        <label for="questionText">Question: </label><br/>
                        <textarea name="questionText" cols="30" rows="5"></textarea>
                        <br/>
                        <label for="questionImage">Image</label><br/>
                        <select name="questionImage" id="" style="width:100%">
                            <option value="name">Name</option>
                        </select>
                        <br/>
                        <label for="questionAudio">Audio</label><br/>
                        <select name="questionAudio" id="" style="width:100%">
                            <option value="name">Name</option>
                        </select>
                        <label for="questionURL">URL</label>
                        <input type="text" name="questionURL"/>
                    </td>
                    <td>
                        <label for="answer">Answer: </label><br/>
                        <textarea name="answer" cols="30" rows="5"></textarea>
                        <br/>
                        <label for="answerImage">Image</label><br/>
                        <select name="answerImage" id="" style="width:100%">
                            <option value="name">Name</option>
                        </select>
                        <br/>
                        <label for="answerAudio">Audio</label><br/>
                        <select name="answerAudio" id="" style="width:100%">
                            <option value="name">Name</option>
                        </select>
                        <label for="answerURL">URL</label>
                        <input type="text" name="answerURL"/>
                    </td>
                </tr>
            </table>
            <div id="questionFormActions1" class="float:right;">
                <button onclick="onCancelQuestionForm()">UPDATE</button>
                <button onclick="onCancelQuestionForm()">CANCEL</button>
            </div>
            <br style="clear:both;"/>
        </div>
    </div>
</body>
	<!-- Common Code -->
	<script src="https://dejai.github.io/scripts/js/common.js"></script>
	<script src="../../src/new/templates.js"></script>
    <script>   

        var CATEGORIES = {
                            "Bands/Rock" : {
                                "order": 1,
                                "questions":
                                [
                                    {
                                        "Value": 100,
                                        "DailyDouble": "No",
                                        "Question": {
                                            "Text": "This is a question for one",
                                            "Image": "",
                                            "Audio": "",
                                            "URL": ""
                                        },
                                        "Answer": {
                                            "Text": "The answer one",
                                            "Image": "",
                                            "Audio": "",
                                            "URL": ""
                                        }
                                    },
                                    {
                                        "Value": 200,
                                        "DailyDouble": "No",
                                        "Question": {
                                            "Text": "This is a question for two",
                                            "Image": "",
                                            "Audio": "",
                                            "URL": ""
                                        },
                                        "Answer": {
                                            "Text": "The answer two",
                                            "Image": "",
                                            "Audio": "",
                                            "URL": ""
                                        }
                                    }
                                ]
                            }
                        }


        function onLoadCategories()
        {

            let categoryNames = Object.keys(CATEGORIES);
            
            // Loop through each category & build HTML templates;
            // The category HTML to load
            categoryHTML = "";

            categoryNames.forEach( (categoryName, idx, array) => {

                let category = CATEGORIES[categoryName];
                console.log(categoryName);
                console.log(category);

                // First, loop through the questions in this category
                questions = category.questions;
                MyTemplates.getTemplate("../../templates/categoryRow.html", questions, (template)=>{

                    // Take the formatted questions & set the section
                    let sectionJSON = {"categoryName":categoryName, "categorySectionBody":template}
                    MyTemplates.getTemplate("../../templates/categorySection.html", sectionJSON, (template) =>{

                        // Add to the category HTML
                        categoryHTML += template;

                        // If last one in set, then show all on the page;
                        if(idx === array.length-1){
                            console.log("Last one");
                            mydoc.setContent("#listOfCategories", {"innerHTML":categoryHTML});
                        }
                    });
                    
                });
            });
        }
        onLoadCategories();

        function onAddQuestion(event)
        {
            let target = event.target; 
            let section = target.closest(".categorySection");
            let name = section.querySelector(".categoryName")?.innerText;
            console.log(target);
            console.log(section);
            console.log(name);

            mydoc.setContent("#questionFormCategoryName",{"innerText":name});

            mydoc.showContent("#questionForm");
            mydoc.hideContent("#listOfCategories");
        }

        function onEditQuestion(event)
        {
            let target = event.target;
            let row = target.closest(".questionRow");
            let section = target.closest(".categorySection");
            let name = section.querySelector(".categoryName")?.innerText;
            let value = row.querySelector(".questionValue")?.innerText;

            console.log(name);
            console.log(value);

        }

        function onCancelQuestionForm()
        {
            mydoc.hideContent("#questionForm");
            mydoc.showContent("#listOfCategories");
        }  
    </script>
</html>